--- a/net/minecraft/network/handshake/client/C00Handshake.java
+++ b/net/minecraft/network/handshake/client/C00Handshake.java
@@ -12,7 +12,7 @@
     private String ip;
     private int port;
     private EnumConnectionState requestedState;
-
+    private boolean hasFMLMarker = false;
     public C00Handshake()
     {
     }
@@ -24,7 +24,13 @@
         this.port = port;
         this.requestedState = requestedState;
     }
-
+    
+    public C00Handshake(int protocol, String address, int port, EnumConnectionState state, boolean addFMLMarker)
+    {
+    	this(protocol, address, port, state);
+    	this.hasFMLMarker = addFMLMarker;
+    }
+    
     /**
      * Reads the raw packet data from the data stream.
      */
@@ -32,6 +38,7 @@
     {
         this.protocolVersion = buf.readVarInt();
         this.ip = buf.readString(255);
+        this.hasFMLMarker = this.ip.contains("\0FML\0");
         this.port = buf.readUnsignedShort();
         this.requestedState = EnumConnectionState.getById(buf.readVarInt());
     }
@@ -43,6 +50,10 @@
     {
         buf.writeVarInt(this.protocolVersion);
         buf.writeString(this.ip);
+        if(!hasFMLMarker)
+        	buf.writeString(this.ip);
+        else
+        	buf.writeString(this.ip + "\0FML\0");
         buf.writeShort(this.port);
         buf.writeVarInt(this.requestedState.getId());
     }
@@ -64,4 +75,8 @@
     {
         return this.protocolVersion;
     }
+    public boolean hasFMLMarker()
+    {
+    	return this.hasFMLMarker;
+    }
 }
